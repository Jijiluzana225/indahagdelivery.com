{% extends 'store/base.html' %}

{% block title %}Order {{ order.id }} Items{% endblock %}

{% block content %}
<style>
    .items-table {
        width: 90%;
        max-width: 1200px;
        margin: 20px auto;
        border-collapse: collapse;
        background-color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .items-table th, .items-table td {
        padding: 12px 15px;
        text-align: center;
        border-bottom: 1px solid #ddd;
    }
    .items-table th {
        background-color: #f8f9fa;
        color: #333;
    }
    .action-btn {
        padding: 6px 10px;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .delete-btn {
        background-color: #dc3545;
    }
    .delete-btn:hover {
        background-color: #c82333;
    }
    .update-btn {
        background-color: #007bff;
    }
    .update-btn:hover {
        background-color: #0056b3;
    }
</style>

<h2 class="text-center">Products for Order #{{ order.id }}</h2>

<table class="items-table">
    <thead>
        <tr>
            <th>Product Name</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Total Price</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for item in items %}
        <tr>
            <td>{{ item.product_name }}</td>
            <td>{{ item.product_price }}</td>
            <td>
                <input type="number" id="quantity-{{ item.id }}" value="{{ item.quantity }}" min="1">
            </td>
            <td>{{ item.total_price|floatformat:2 }}</td>
            <td>
                <button class="action-btn update-btn" onclick="updateItem({{ item.id }})">Update</button>
                <button class="action-btn delete-btn" onclick="deleteItem({{ item.id }})">Delete</button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
    function updateItem(itemId) {
        const quantity = document.getElementById(`quantity-${itemId}`).value;

        fetch(`/update-item/${itemId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({ quantity: quantity })
        })
        .then(response => {
            if (response.ok) {
                alert('Item updated successfully!');
                location.reload();
            } else {
                alert('Failed to update item.');
            }
        });
    }

    function deleteItem(itemId) {
        if (confirm('Are you sure you want to delete this item?')) {
            fetch(`/delete-item/${itemId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
            .then(response => {
                if (response.ok) {
                    alert('Item deleted successfully!');
                    location.reload();
                } else {
                    alert('Failed to delete item.');
                }
            });
        }
    }
</script>
{% endblock %}
