<style>
    .status {
        font-weight: bold;
        padding: 8px 12px;
        border-radius: 4px;
        color: white; /* Ensure text is visible on all background colors */
    }

    .status.Pending {
        background-color: #ffc107; /* Yellow for Pending */
    }

    .status.Preparing {
        background-color: #17a2b8; /* Teal for Preparing */
    }

    .status.On_the_Way {
        background-color: #28a745; /* Green for On the Way */
    }

    .status.Delivered {
        background-color: #007bff; /* Blue for Delivered */
    }

    /* Retain existing styles */
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f9f9f9;
        color: #333;
    }

    .orders-title {
        font-size: 2.5rem;
        color: #333;
        text-align: center;
        margin: 20px 0;
    }

    .orders-table-container {
        width: 95%;
        max-width: 1200px;
        margin: 0 auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .orders-table {
        width: 100%;
        border-collapse: collapse;
    }

    .orders-table th, 
    .orders-table td {
        padding: 12px 15px;
        text-align: center;
        font-size: 1rem;
        border-bottom: 1px solid #ddd;
    }

    .orders-table th {
        background-color: #f1f1f1;
        color: #333;
        font-weight: bold;
    }

    .orders-table tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    .orders-table tr:hover {
        background-color: #f1f1f1;
    }

    .update-btn, 
    .map-btn {
        padding: 8px 15px;
        font-size: 0.9rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        color: #fff;
    }

    .update-btn {
        background-color: #007bff;
    }

    .update-btn:hover {
        background-color: #0056b3;
    }

    .map-btn {
        background-color: #28a745;
    }

    .map-btn:hover {
        background-color: #1e7e34;
    }
</style>

<h2 class="orders-title">Store Orders</h2>
<div class="orders-table-container">
    <table class="orders-table">
        <thead>
            <tr>
                <th>Order ID</th>
                <th>Customer</th>
                <th>Location</th>
                <th>Total Amount</th>
                <th>Status</th>
                <th>Orders</th>
                <th>Created At</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
                <tr class="order-row">
                    <td>{{ order.id }}</td>
                    <td>{{ order.customer_name }}</td>
                    <td>
                        <button class="map-btn" onclick="openGoogleMaps('{{ order.customer_location }}')">Map</button>
                    </td>
                    <td>{{ order.total_amount|floatformat:2 }}</td>
                    <td>
                       {{ order.status }}
                    </td>
                    <td>
                        <a href="/order/{{ order.id }}/items" class="btn btn-primary">Orders</a>
                    </td>
                    <td>{{ order.created_at }}</td>
                    <td>
                        <button class="update-btn" onclick="updateOrderStatus({{ order.id }})">Update</button>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    function updateOrderStatus(orderId) {
        var status = document.getElementById('status-' + orderId).value;
        var button = document.querySelector(`button[onclick="updateOrderStatus(${orderId})"]`);
        button.textContent = "Updating...";
        button.disabled = true;

        var xhr = new XMLHttpRequest();
        xhr.open("POST", "{% url 'update_order_status' %}", true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");

        xhr.onload = function() {
            if (xhr.status == 200) {
                alert("Order ID " + orderId + " status updated to " + status);
            } else {
                alert("Failed to update status. Please try again.");
            }
            button.textContent = "Update";
            button.disabled = false;
        };

        xhr.onerror = function() {
            alert("An error occurred. Please check your connection and try again.");
            button.textContent = "Update";
            button.disabled = false;
        };

        var data = JSON.stringify({
            "order_id": orderId,
            "status": status
        });

        xhr.send(data);
    }

    function openGoogleMaps(destination) {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function (position) {
                const userLat = position.coords.latitude;
                const userLng = position.coords.longitude;

                const mapsUrl = `https://www.google.com/maps/dir/?api=1&origin=${userLat},${userLng}&destination=${encodeURIComponent(destination)}`;

                // Open Google Maps in a new tab
                window.open(mapsUrl, '_blank');

              
            function (error) {
                alert("Unable to retrieve your location. Please enable location services and try again.");
            }
        );
    } else {
        alert("Geolocation is not supported by your browser.");
    }
}
</script>
